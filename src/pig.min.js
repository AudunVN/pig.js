!function(t){"use strict";function e(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])}function i(t,i,s){return this.inRAF=!1,this.isTransitioning=!1,this.visibleImages=[],this.latestYOffset=0,this.lastWindowWidth=window.innerWidth,this.scrollDirection="down",this.settings=a,e(this.settings,s||{}),this.container=t,this.images=this._parseImageData(i),t||console.error("Container must not be null."),this}function s(t,e,i){this.isVisible=!1,this.existsOnPage=!1,this.index=e,this.date=Date.parse(t.date),this.aspectRatio=t.aspectRatio,this.filename=t.filename,this.sizes={},this.thumbnailLoaded=!1,this.loaded=!1;for(var s in o)o.hasOwnProperty(s)&&(this.sizes[s]=i.settings.urlForSize(this.filename,o[s]));return this}var n=function(){function t(){s||(s=!0,window.requestAnimationFrame?window.requestAnimationFrame(e):setTimeout(e,66))}function e(){i.forEach(function(t){t()}),s=!1}var i=[],s=!1;return{add:function(e){i.length||window.addEventListener("resize",t),i.push(e)},disable:function(){window.removeEventListener("resize",t)},reEnable:function(){window.addEventListener("resize",t)}}}(),a={mobileWidth:640,spaceBetweenImages:8,transitionSpeed:300,urlForSize:function(t,e){return"/"+t+"?s="+e},getMinAspectRatio:function(){var t=window.innerWidth;return 640>=t?2:1280>=t?4:1920>=t?5:6}},o={thumbnail:20,small:100,medium:250,large:500},h=1.5,r=3e3,l=1e3;i.prototype._getTransitionTimeout=function(){return this.settings.transitionSpeed*h},i.prototype._getTransitionString=function(){return this.isTransitioning?this.settings.transitionSpeed/1e3+"s transform ease":"none"},i.prototype._maxAspectRatioRequiresTransition=function(t){var e=this.latestMaxAspectRatio||t;return this.latestMaxAspectRatio=t,t!==e},i.prototype._parseImageData=function(t){var e=[];return t.forEach(function(t,i){var n=new s(t,i,this);e.push(n)}.bind(this)),e},i.prototype._computeLayout=function(){var t=[],e=0,i=0,s=0,n=parseInt(this.container.clientWidth),a=this.settings.getMinAspectRatio();!this.isTransitioning&&this._maxAspectRatioRequiresTransition(a)&&(this.isTransitioning=!0,setTimeout(function(){this.isTransitioning=!1},this._getTransitionTimeout()));var o=this._getTransitionString();[].forEach.call(this.images,function(h,r){if(s+=parseFloat(h.aspectRatio),t.push(h),s>=a||r+1===this.images.length){var l=n-this.settings.spaceBetweenImages*(t.length-1),u=l/s;t.forEach(function(t){var s=u*t.aspectRatio;t.style={width:parseInt(s),height:parseInt(u),translateX:e,translateY:i,transition:o},e+=s+this.settings.spaceBetweenImages}.bind(this)),t=[],s=0,i+=parseInt(u)+this.settings.spaceBetweenImages,e=0}}.bind(this)),this.totalHeight=i-this.settings.spaceBetweenImages},i.prototype._doLayout=function(){this.container.style.height=this.totalHeight+"px";var t=this.container.offsetTop,e=window.innerHeight,i="up"===this.scrollDirection?r:l,s="down"===this.scrollDirection?r:l,n=this.latestYOffset-t-i,a=this.latestYOffset+e+s;this.images.forEach(function(t){if(t.style.translateY+t.style.height<n||t.style.translateY>a)t.existsOnPage&&this.container.removeChild(t.getElement()),t.hide();else{if(!t.existsOnPage){var e=t.getElement();if(!this.visibleImages.length||t.index>this.visibleImages[this.visibleImages.length-1].index)this.container.appendChild(e);else if(t.index<this.visibleImages[0].index)this.container.insertBefore(e,this.visibleImages[0].getElement());else{for(var i=0;this.visibleImages[i].index<t.index;)i++;this.container.insertBefore(e,this.visibleImages[i])}t.existsOnPage=!0}t.load(this.lastWindowWidth)}}.bind(this))},i.prototype.getOnScroll=function(){var t=this,e=function(){var e=window.pageYOffset;t.previousYOffset=t.latestYOffset||e,t.latestYOffset=e,t.scrollDirection=t.latestYOffset>t.previousYOffset?"down":"up",t.inRAF||(t.inRAF=!0,window.requestAnimationFrame(function(){t._doLayout(),t.inRAF=!1}))};return e},i.prototype.enable=function(){return this.onScroll=this.getOnScroll(),window.addEventListener("scroll",this.onScroll),this.onScroll(),this._computeLayout(),this._doLayout(),n.add(function(){this.lastWindowWidth=window.innerWidth,this._computeLayout(),this._doLayout()}.bind(this)),this},i.prototype.disable=function(){return window.removeEventListener("scroll",this.onScroll),n.disable(),this},i.prototype.stats=function(){for(var t=0,e=this.images[0].existsOnPage,i=1;i<this.images.length;i++){var s=this.images[i];s.existsOnPage!==e&&(t=i,e=s.existsOnPage)}},s.prototype.load=function(t){setTimeout(function(){this.existsOnPage&&(this._updateStyles(),this.isVisible||(this.thumbnail||(this.thumbnail=new Image,this.thumbnail.src=this.sizes.thumbnail,this.thumbnail.className="progressive-thumbnail",this.thumbnail.onload=function(){this.thumbnail&&(this.thumbnail.className+=" loaded",this.thumbnailLoaded=!0)}.bind(this),this.element.appendChild(this.thumbnail)),this.fullImage||(this.fullImage=new Image,640>=t?this.fullImage.src=this.sizes.small:this.fullImage.src=this.sizes.medium,this.fullImage.onload=function(){this.fullImage&&(this.fullImage.className+=" loaded",this.loaded=!0)}.bind(this),this.element.appendChild(this.fullImage))))}.bind(this),100)},s.prototype.hide=function(){this.element&&(this.thumbnail&&(this.element.removeChild(this.thumbnail),delete this.thumbnail),this.fullImage&&(this.element.removeChild(this.fullImage),delete this.fullImage)),this.existsOnPage=!1,this.isVisible=!1},s.prototype.getElement=function(){return this.element||(this.element=document.createElement("figure"),this.element.className="progressive",this._updateStyles()),this.element},s.prototype._updateStyles=function(){this.element.style.transition=this.style.transition,this.element.style.width=this.style.width+"px",this.element.style.height=this.style.height+"px",this.element.style.transform="translate3d("+this.style.translateX+"px,"+this.style.translateY+"px, 0)"},"function"==typeof define&&define.amd?define(i):"undefined"!=typeof module&&module.exports?module.exports=i:t.Pig=i}(this);